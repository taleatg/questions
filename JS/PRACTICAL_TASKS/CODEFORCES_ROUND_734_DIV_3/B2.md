# B2. Wonderful Coloring - 2

This problem is an extension of the problem "Wonderful Coloring - 1". It has quite many differences, so you should read this statement completely.

Recently, Paul and Mary have found a new favorite sequence of integers a1,a2,…,an. They want to paint it using pieces of chalk of k colors. The coloring of a sequence is called wonderful if the following conditions are met:

1. each element of the sequence is either painted in one of k colors or isn't painted;
2. each two elements which are painted in the same color are different (i. e. there's no two equal values painted in the same color);
3. let's calculate for each of k colors the number of elements painted in the color — all calculated numbers must be equal;
4. the total number of painted elements of the sequence is the maximum among all colorings of the sequence which meet the first three conditions.

E. g. consider a sequence a=[3,1,1,1,1,10,3,10,10,2] and k=3. One of the wonderful colorings of the sequence is shown in the figure.

[details >>>](https://codeforces.com/contest/1551/problem/B2)

    const readNum = () => +readline();
    const readStr = () => readline();
    const readNumArr = () => readline().split(' ').map(item => +item);
    
    const n = readNum();
    
    for(var i = 0; i < n; i++) {
      var ans = readNumArr();
      var m = ans[0];
      var k = ans[1];
      var vals = readNumArr();
      
      ans = []
      
      var uniq = new Map();
      var count = 0;
      
      for(var j = 0; j < m; j++) {
        var item = uniq.get(vals[j]);
        ans[j] = 0;
        
        if(!item) {
          uniq.set(vals[j], []);
          item = uniq.get(vals[j]);
        }
        
        item.push(j)
      }
      
      uniq.forEach(item => {
        count += item.length < k ? item.length : k;
      });
      
      count -= count % k;
      
      var lk = 0;
      
      uniq.forEach(item => {
        for(var j = 0; j < item.length && j < k; j++) {
          if(count) {
            lk++;
            ans[item[j]] = lk;
            if(lk === k) {
              lk = 0;
            }
            count--;
          }
        }
      });
      
      print(ans.join(' '));
    }
